{% extends 'base.html' %}

{% block title %}{{ username }}'s Profile - SciWeb 3.0{% endblock %}

{% block head %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/user_profile.css') }}">
{% endblock %}

{% block content %}
<div class="user-profile-container">
    <div class="profile-header">
        <div class="profile-banner"></div>
        <div class="profile-header-content">
            <div class="profile-picture-container">
                <img src="{{ url_for('static', filename='images/default-avatar.png') }}" alt="{{ username }}'s Profile Picture" class="profile-picture">
            </div>
            <div class="profile-info">
                <h1>{{ full_name }}</h1>
                <p class="username">@{{ username }}</p>
                {% if bio %}
                <p class="bio">{{ bio }}</p>
                {% endif %}
                
                <div class="profile-stats">
                    <div class="stat">
                        <span class="stat-count">{{ class_count }}</span>
                        <span class="stat-label">Classes</span>
                    </div>
                    <div class="stat">
                        <span class="stat-count">{{ friend_count }}</span>
                        <span class="stat-label">Friends</span>
                    </div>
                    <div class="stat">
                        <span class="stat-count">{{ connection_count }}</span>
                        <span class="stat-label">Web Connections</span>
                    </div>
                </div>
                
                <div class="profile-actions">
                    {% if is_self %}
                        <a href="/profile" class="btn btn-secondary"><i class="fas fa-pencil-alt"></i> Edit Profile</a>
                    {% elif is_friend %}
                        <button class="btn btn-secondary message-btn"><i class="fas fa-comment"></i> Message</button>
                        <button class="btn btn-danger unfriend-btn"><i class="fas fa-user-minus"></i> Unfriend</button>
                    {% elif request_sent %}
                        <button class="btn btn-secondary request-pending" disabled><i class="fas fa-clock"></i> Request Pending</button>
                        <button class="btn btn-danger cancel-request-btn"><i class="fas fa-times"></i> Cancel Request</button>
                    {% else %}
                        <button class="btn btn-primary add-friend-btn"><i class="fas fa-user-plus"></i> Add Friend</button>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
    
    <div class="profile-content">
        <div class="profile-nav">
            <button class="profile-nav-item active" data-section="overview">Overview</button>
            {% if is_friend or classes_visibility == 'everyone' %}
            <button class="profile-nav-item" data-section="classes">Classes</button>
            {% endif %}
            {% if is_friend or web_visibility == 'everyone' %}
            <button class="profile-nav-item" data-section="knowledge-web">Knowledge Web</button>
            {% endif %}
            {% if is_friend or friends_visibility == 'everyone' %}
            <button class="profile-nav-item" data-section="friends">Friends</button>
            {% endif %}
        </div>
        
        <div id="overview-section" class="profile-section active">
            <h2>About {{ first_name }}</h2>
            
            <div class="about-cards">
                <div class="about-card">
                    <div class="card-icon">
                        <i class="fas fa-graduation-cap"></i>
                    </div>
                    <h3>Education</h3>
                    <p>{{ education }}</p>
                </div>
                
                <div class="about-card">
                    <div class="card-icon">
                        <i class="fas fa-medal"></i>
                    </div>
                    <h3>Achievements</h3>
                    <ul class="achievements-list">
                        {% for achievement in achievements %}
                        <li>
                            <span class="achievement-icon"><i class="{{ achievement.icon }}"></i></span>
                            <span class="achievement-name">{{ achievement.name }}</span>
                        </li>
                        {% endfor %}
                    </ul>
                </div>
                
                <div class="about-card">
                    <div class="card-icon">
                        <i class="fas fa-lightbulb"></i>
                    </div>
                    <h3>Interests</h3>
                    <div class="interests-list">
                        {% for interest in interests %}
                        <span class="interest-tag">{{ interest }}</span>
                        {% endfor %}
                    </div>
                </div>
            </div>
            
            {% if is_friend and motivations_visibility == 'friends' or motivations_visibility == 'everyone' %}
            <div class="motivations-section">
                <h2>Motivations</h2>
                <div class="motivations-list">
                    {% for motivation in motivations %}
                    <div class="motivation-card">
                        <h3>{{ motivation.title }}</h3>
                        <p>{{ motivation.description }}</p>
                        <div class="motivation-meta">
                            <span class="deadline"><i class="fas fa-calendar"></i> Deadline: {{ motivation.deadline }}</span>
                            <div class="motivation-tags">
                                {% for tag in motivation.tags %}
                                <span class="motivation-tag">{{ tag }}</span>
                                {% endfor %}
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>
            {% endif %}
            
            <div class="recent-activity">
                <h2>Recent Activity</h2>
                
                <div class="activity-timeline">
                    {% for activity in recent_activities %}
                    <div class="activity-item">
                        <div class="activity-icon">
                            <i class="{{ activity.icon }}"></i>
                        </div>
                        <div class="activity-content">
                            <p class="activity-text">{{ activity.text }}</p>
                            <span class="activity-time">{{ activity.time }}</span>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>
        </div>
        
        {% if is_friend or classes_visibility == 'everyone' %}
        <div id="classes-section" class="profile-section">
            <h2>{{ first_name }}'s Classes</h2>
            
            <div class="classes-grid">
                {% for class in classes %}
                <div class="class-card">
                    <div class="class-header">
                        <h3>{{ class.name }}</h3>
                        <span class="class-period">{{ class.period }}</span>
                    </div>
                    <p class="class-teacher">{{ class.teacher }}</p>
                    <div class="class-stats">
                        <div class="class-stat">
                            <i class="fas fa-brain"></i>
                            <span>{{ class.nodes }} Nodes</span>
                        </div>
                        <div class="class-stat">
                            <i class="fas fa-link"></i>
                            <span>{{ class.connections }} Connections</span>
                        </div>
                    </div>
                    <a href="/class/{{ class.id }}" class="btn btn-secondary btn-sm view-class-btn">View Class</a>
                </div>
                {% endfor %}
            </div>
        </div>
        {% endif %}
        
        {% if is_friend or web_visibility == 'everyone' %}
        <div id="knowledge-web-section" class="profile-section">
            <h2>{{ first_name }}'s Knowledge Web</h2>
            
            <div class="web-summary">
                <div class="web-stat-card">
                    <div class="web-stat-icon">
                        <i class="fas fa-brain"></i>
                    </div>
                    <div class="web-stat-info">
                        <span class="web-stat-count">{{ total_nodes }}</span>
                        <span class="web-stat-label">Total Nodes</span>
                    </div>
                </div>
                
                <div class="web-stat-card">
                    <div class="web-stat-icon">
                        <i class="fas fa-link"></i>
                    </div>
                    <div class="web-stat-info">
                        <span class="web-stat-count">{{ total_connections }}</span>
                        <span class="web-stat-label">Total Connections</span>
                    </div>
                </div>
                
                <div class="web-stat-card">
                    <div class="web-stat-icon">
                        <i class="fas fa-lightbulb"></i>
                    </div>
                    <div class="web-stat-info">
                        <span class="web-stat-count">{{ key_insights }}</span>
                        <span class="web-stat-label">Key Insights</span>
                    </div>
                </div>
            </div>
            
            <div class="web-preview">
                <div class="web-preview-container">
                    <!-- This would contain a simplified, static visualization of the user's knowledge web -->
                    <img src="{{ url_for('static', filename='images/web-preview.png') }}" alt="Knowledge Web Preview" class="web-preview-image">
                </div>
                <a href="/tree?user={{ username }}" class="btn btn-primary view-web-btn">View Full Knowledge Web</a>
            </div>
        </div>
        {% endif %}
        
        {% if is_friend or friends_visibility == 'everyone' %}
        <div id="friends-section" class="profile-section">
            <h2>{{ first_name }}'s Friends</h2>
            
            <div class="friends-search">
                <input type="text" placeholder="Search {{ first_name }}'s friends..." class="form-control">
            </div>
            
            <div class="friends-grid">
                {% for friend in friends %}
                <div class="friend-card">
                    <img src="{{ url_for('static', filename='images/default-avatar.png') }}" alt="{{ friend.username }}" class="friend-avatar">
                    <h3>{{ friend.name }}</h3>
                    <p class="friend-username">@{{ friend.username }}</p>
                    {% if friend.is_mutual %}
                    <span class="mutual-friend-badge"><i class="fas fa-user-friends"></i> Mutual Friend</span>
                    {% endif %}
                    <a href="/users/{{ friend.username }}" class="btn btn-secondary btn-sm view-profile-btn">View Profile</a>
                </div>
                {% endfor %}
            </div>
        </div>
        {% endif %}
    </div>
</div>
{% endblock %}

{% block scripts %}
<script src="{{ url_for('static', filename='js/user_profile.js') }}"></script>
{% endblock %} 